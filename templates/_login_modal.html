<div class="modal fade" id="janela">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg rounded-4">
          <div class="modal-header bg-custom-1 text-white">
              <h1 class="modal-title">Login</h1>
              <button type="button" class="btn-close btn-close-black" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-4">
   
            <div class="alert alert-danger" role="alert">
                <p>Ops! Parece que seu login ou senha estão incorretos. <br> Por favor, verifique e tente novamente.</p>
            </div>

              <div class="login">
                  <form method="post" class="formLogin" action="{% url 'login' %}">
                      {% csrf_token %}
                      <p class="text-muted">Digite os seus dados de acesso no campo abaixo.</p>

                      <label for="user_type" class="form-label">Selecione o tipo de usuário:</label>
                      <select id="user_type" name="user_type" class="form-select mb-3" required onchange="applyMaskAndShowFields()">
                          <option value="" disabled selected>Selecione...</option>
                          <option value="administrador">Administrador</option>
                          <option value="instituicao">Instituição</option>
                          <option value="profissional">Profissional</option>
                      </select>

                      <div id="loginFields" class="mt-3" style="display:none;">
                          <div class="mb-3">
                              <label for="username" class="form-label">Usuário</label>
                              <input type="text" id="username" name="username" class="form-control" value="{{ form.username.value|default_if_none:'' }}" required>
                          </div>
                          <div class="mb-3">
                              <label for="password" class="form-label">Senha</label>
                              <input type="password" id="password" name="password" class="form-control" required>
                          </div>
                      </div>

                      <div class="d-flex flex-column justify-content-center align-items-center gap-4">
                          <a href="{% url 'password_reset' %}" class="text-primary">Esqueci minha senha</a>
                          <input type="submit" value="Acessar" class="btn btn-custom btn-text-color px-4" />
                      </div>
                  </form>
              </div>
          </div>

          <div class="modal-footer border-0">
              
          </div>
      </div>
  </div>
</div>

<script>
  function applyMaskAndShowFields() {
      var userType = document.getElementById('user_type').value;
      var usernameField = document.getElementById('username');
      var loginFields = document.getElementById('loginFields');

      // Exibe os campos de login
      loginFields.style.display = 'block';

      // Limpa o valor do campo ao trocar a seleção
      usernameField.value = '';

      // Remove qualquer máscara existente
      $(usernameField).unmask();

      if (userType === 'instituicao') {
          usernameField.placeholder = 'Digite o CNPJ (xx.xxx.xxx/xxxx-xx)';
          $(usernameField).mask('00.000.000/0000-00');
      } else if (userType === 'profissional') {
          usernameField.placeholder = 'Digite o CPF (xxx.xxx.xxx-xx)';
          $(usernameField).mask('000.000.000-00');
      } else {
          usernameField.placeholder = 'Digite seu login';
      }
  }

  // Garante que os campos sejam ocultados corretamente ao abrir o modal
  $('#janela').on('shown.bs.modal', function () {
      document.getElementById('loginFields').style.display = 'none';
  });
</script>

<!-- Importar jQuery e jQuery Mask Plugin -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
